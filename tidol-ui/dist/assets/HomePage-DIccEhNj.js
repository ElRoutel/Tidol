import{r as p,a as g,j as e,I as N,b as k,u as S,c as C,d as A,e as M,f as q,g as B}from"./index-DEEaUcvV.js";import{u as H}from"./useLazyCaching--lO-_a-b.js";import{S as U}from"./SkeletonSongList-DCf44Kff.js";const W=t=>{if(!Array.isArray(t))return[];const i=[...t];let r=i.length,n;for(;r!==0;)n=Math.floor(Math.random()*r),r--,[i[r],i[n]]=[i[n],i[r]];return i},O=()=>{const[t,i]=p.useState("all"),[r,n]=p.useState(!0),[u,l]=p.useState({recentListenings:[],quickSelection:[],albums:[],coversRemixes:[]}),x=p.useCallback(async h=>{n(!0);try{const a=h==="all"?"":` ${h}`,o=g.get("/history",{timeout:5e3}).catch(()=>({data:[]})),c=g.get("/music/home-recommendations",{timeout:5e3}).catch(()=>({data:[]})),f=g.get("/music/albums",{timeout:5e3}).catch(()=>({data:[]})),m=`cover remix${a}`,b=g.get(`/music/search?q=${encodeURIComponent(m)}`,{timeout:5e3}).catch(()=>({data:{canciones:[]}})),s=g.get("/music/ia/discoveries",{timeout:8e3}).catch(()=>({data:[]})),[d,$,P,E,D]=await Promise.all([o,c,f,b,s]),y=d.data||[],w=$.data||[],L=P.data||[],z=E.data?.canciones||[],I=D.data||[],T=[...y.slice(0,6),...w.slice(0,6)];l({recentListenings:y.slice(0,20),quickSelection:W(T).slice(0,6),recommendations:w.slice(0,15),albums:L.slice(0,15),coversRemixes:z.slice(0,10),iaDiscoveries:I.slice(0,15)})}catch(a){console.error("Error fetching home data:",a)}finally{n(!1)}},[]);return p.useEffect(()=>{x(t)},[t,x]),{selectedChip:t,setSelectedChip:i,isLoading:r,data:u,fetchHomeData:x}},F=[{id:"all",label:"Todo"},{id:"podcasts",label:"Podcasts"},{id:"relax",label:"Relax"},{id:"workout",label:"Entrenamiento"},{id:"party",label:"Fiesta"},{id:"focus",label:"Concentraci칩n"}];function V({selectedChip:t,onSelectChip:i}){const r=p.useRef(null),[n,u]=p.useState(!1),[l,x]=p.useState(!0),h=()=>{if(!r.current)return;const{scrollLeft:o,scrollWidth:c,clientWidth:f}=r.current;u(o>0),x(o<c-f-5)};p.useEffect(()=>(h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)),[]);const a=o=>{if(!r.current)return;const c=300;r.current.scrollBy({left:o==="left"?-c:c,behavior:"smooth"})};return e.jsxs("div",{className:"relative group w-full mb-6",children:[e.jsx("button",{onClick:()=>a("left"),className:`hidden md:block absolute left-0 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-black/50 backdrop-blur-md border border-white/10 text-white hover:bg-white/20 transition-all ${n?"opacity-100 visible":"opacity-0 invisible"}`,"aria-label":"Scroll left",children:e.jsx(N,{size:20})}),e.jsx("div",{ref:r,onScroll:h,className:"flex overflow-x-auto gap-3 px-4 py-2 scrollbar-hide snap-x",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:F.map(o=>e.jsx("button",{onClick:()=>i(o.id),className:`
              whitespace-nowrap px-4 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 snap-start
              ${t===o.id?"bg-white text-black shadow-lg scale-105":"bg-white/10 text-white hover:bg-white/20 border border-white/5"}
            `,children:o.label},o.id))}),e.jsx("button",{onClick:()=>a("right"),className:`hidden md:block absolute right-0 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-black/50 backdrop-blur-md border border-white/10 text-white hover:bg-white/20 transition-all ${l?"opacity-100 visible":"opacity-0 invisible"}`,"aria-label":"Scroll right",children:e.jsx(k,{size:20})})]})}function v({title:t,subtitle:i,children:r}){const n=p.useRef(null),u=l=>{if(n.current){const{current:x}=n,h=l==="left"?-x.offsetWidth/2:x.offsetWidth/2;x.scrollBy({left:h,behavior:"smooth"})}};return e.jsxs("div",{className:"flex flex-col gap-4 py-4 group relative z-0",children:[e.jsxs("div",{className:"flex flex-col px-4 md:px-0 mb-2",children:[i&&e.jsx("span",{className:"text-[#999] text-xs font-semibold uppercase tracking-wider mb-2",children:i}),e.jsx("h2",{className:"text-white text-2xl md:text-3xl font-bold",children:t})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>u("left"),className:"hidden md:group-hover:flex absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-[#212121] border border-white/10 rounded-full items-center justify-center text-white shadow-xl hover:bg-[#333] transition-all -ml-5","aria-label":"Scroll left",children:e.jsx(N,{size:24})}),e.jsx("div",{ref:n,className:"flex overflow-x-auto gap-4 px-4 md:px-0 pb-4 hover-scrollbar snap-x scroll-smooth",children:r}),e.jsx("button",{onClick:()=>u("right"),className:"hidden md:group-hover:flex absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-[#212121] border border-white/10 rounded-full items-center justify-center text-white shadow-xl hover:bg-[#333] transition-all -mr-5","aria-label":"Scroll right",children:e.jsx(k,{size:24})})]})]})}function R({isPlaying:t=!1}){return e.jsxs("div",{className:`flex items-end justify-center gap-[2px] h-4 w-4 transition-opacity duration-300 ${t?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:`w-[3px] bg-white ${t?"animate-music-bar-1":"h-[2px] transition-all duration-300"}`}),e.jsx("div",{className:`w-[3px] bg-white ${t?"animate-music-bar-2":"h-[2px] transition-all duration-300 delay-75"}`}),e.jsx("div",{className:`w-[3px] bg-white ${t?"animate-music-bar-3":"h-[2px] transition-all duration-300 delay-150"}`}),e.jsx("style",{children:`
        @keyframes music-bar {
          0%, 100% { height: 20%; }
          50% { height: 100%; }
        }
        .animate-music-bar-1 { animation: music-bar 0.6s ease-in-out infinite alternate; }
        .animate-music-bar-2 { animation: music-bar 0.8s ease-in-out infinite alternate; }
        .animate-music-bar-3 { animation: music-bar 0.5s ease-in-out infinite alternate; }
      `})]})}function Q({item:t,onClick:i,isActive:r}){const{openContextMenu:n}=S(),u=l=>{l.preventDefault(),l.stopPropagation(),n(l,"song",t)};return e.jsxs("div",{onClick:i,onContextMenu:u,className:"group/card flex items-center rounded-lg overflow-hidden cursor-pointer transition-all duration-300 ease-apple pr-4 h-20 relative",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.05)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},onMouseEnter:l=>{l.currentTarget.style.transform="scale(1.02)",l.currentTarget.style.background="rgba(255, 255, 255, 0.1)",l.currentTarget.style.border="1px solid rgba(255, 255, 255, 0.15)"},onMouseLeave:l=>{l.currentTarget.style.transform="scale(1)",l.currentTarget.style.background="rgba(255, 255, 255, 0.03)",l.currentTarget.style.border="1px solid rgba(255, 255, 255, 0.05)"},children:[e.jsxs("div",{className:"relative h-full aspect-square flex-shrink-0",children:[e.jsx("img",{src:t.image||t.portada||t.cover||"/default-album.png",alt:t.title||t.titulo,className:"w-full h-full object-cover"}),r?e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:e.jsx(R,{isPlaying:!0})}):e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover/card:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 bg-primary rounded-full flex items-center justify-center shadow-lg",children:e.jsx(C,{className:"text-black ml-0.5",size:18})})})]}),e.jsxs("div",{className:"flex flex-col justify-center ml-4 min-w-0 flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-sm md:text-base truncate leading-tight",children:t.title||t.titulo}),e.jsx("p",{className:"text-[#aaa] text-xs md:text-sm truncate mt-0.5",children:t.artist||t.artista||"Desconocido"})]})]})}const _=t=>t?t.artist?t.artist:t.artista?t.artista:t.autor?t.autor:Array.isArray(t.artists)&&t.artists.length>0?t.artists[0].name||t.artists[0].titulo||"Artista":t.subtitle?t.subtitle:t.description?t.description:t.owner?t.owner:"Desconocido":"Desconocido";function j({item:t,onClick:i,onPlay:r,isActive:n}){const{openContextMenu:u}=S(),l=t.title||t.titulo||t.name||"Sin T칤tulo",x=t.image||t.portada||t.cover||t.thumbnail||"/default-album.png",h=_(t),a=c=>{c.stopPropagation(),c.preventDefault(),r&&r()},o=c=>{c.preventDefault(),c.stopPropagation(),u(c,"song",t)};return e.jsxs("div",{onClick:i,onContextMenu:o,className:"group/card flex flex-col gap-3 w-[160px] md:w-[200px] cursor-pointer flex-shrink-0 transition-all duration-200",children:[e.jsxs("div",{className:"relative aspect-square w-full overflow-hidden rounded-lg",children:[e.jsx("img",{src:x,alt:l,className:"w-full h-full object-cover transition-transform duration-300 group-hover/card:scale-105"}),n?e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center rounded-lg",children:e.jsx(R,{isPlaying:!0})}):r?e.jsx("div",{onClick:a,className:"absolute inset-0 bg-black/40 opacity-0 group-hover/card:opacity-100 transition-all duration-200 flex items-center justify-center rounded-lg hover:bg-black/50",children:e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-primary rounded-full flex items-center justify-center shadow-lg transform transition-transform group-hover/card:scale-110",children:e.jsx(C,{className:"text-black ml-0.5",size:24})})}):null]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"text-white font-semibold text-sm md:text-base truncate leading-tight",children:l}),e.jsxs("p",{className:"text-[#aaa] text-xs md:text-sm truncate mt-1",children:[h,t.play_count>0&&e.jsxs("span",{className:"ml-2 text-[10px] bg-white/10 px-1.5 py-0.5 rounded-full",children:[t.play_count," plays"]})]})]})]})}function G({data:t,onPlay:i}){const{recentListenings:r,quickSelection:n,recommendations:u,albums:l,coversRemixes:x,iaDiscoveries:h}=t||{},{currentSong:a,isPlaying:o}=A(),{user:c}=M(),f=q(),m=s=>a?.id===s.id,b=s=>m(s)&&o;return e.jsxs("div",{className:"flex flex-col gap-16 pb-32 animate-fade-in w-full max-w-[100vw] overflow-x-hidden",children:[n&&n.length>0&&e.jsxs("section",{className:"px-4 md:px-0 mt-8",children:[e.jsxs("div",{className:"mb-6 px-4 md:px-0",children:[e.jsx("span",{className:"text-white/40 text-xs font-bold uppercase tracking-wider mb-2 block font-mono",children:"PARA EMPEZAR"}),e.jsx("h2",{className:"text-white text-2xl md:text-3xl font-bold tracking-tight",children:"Selecci칩n r치pida"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 px-4 md:px-0",children:n.map((s,d)=>e.jsx(Q,{item:s,isActive:m(s),isPlaying:b(s),onClick:()=>i(s,d,n)},`${s.id}-${d}`))})]}),r&&r.length>0&&e.jsx("section",{className:"px-4 md:px-0",children:e.jsx(v,{title:"Volver a escuchar",subtitle:c?.username||"ROUTEL",children:r.map((s,d)=>e.jsx(j,{item:s,isActive:m(s),isPlaying:b(s),onClick:()=>i(s,d,r),onPlay:()=>i(s,d,r)},`${s.id}-${d}`))})}),u&&u.length>0&&e.jsx("section",{className:"px-4 md:px-0",children:e.jsx(v,{title:"Recomendado para ti",subtitle:"BASADO EN TUS GUSTOS",children:u.map((s,d)=>e.jsx(j,{item:s,isActive:m(s),isPlaying:b(s),onClick:()=>i(s,d,u),onPlay:()=>i(s,d,u)},`${s.id}-${d}`))})}),l&&l.length>0&&e.jsx("section",{className:"px-4 md:px-0",children:e.jsx(v,{title:"츼lbumes populares",subtitle:"TENDENCIAS",children:l.map((s,d)=>e.jsx(j,{item:s,isActive:m(s),isPlaying:b(s),onClick:()=>f(`/album/${s.id}`)},`${s.id}-${d}`))})}),x&&x.length>0&&e.jsx("section",{className:"px-4 md:px-0",children:e.jsx(v,{title:"Covers y Remixes",subtitle:"DESCUBRIMIENTOS",children:x.map((s,d)=>e.jsx(j,{item:s,isActive:m(s),isPlaying:b(s),onClick:()=>i(s,d,x)},`${s.id}-${d}`))})}),h&&h.length>0&&e.jsx("section",{className:"px-4 md:px-0",children:e.jsx(v,{title:"Descubrimientos IA",subtitle:"INTERNET ARCHIVE",children:h.map((s,d)=>e.jsx(j,{item:s,isActive:!1,isPlaying:!1,onClick:()=>f(`/ia-album/${s.identifier||s.id}`)},`${s.id}-${d}`))})})]})}function X(){const{playSongList:t}=A(),{selectedChip:i,setSelectedChip:r,isLoading:n,data:u}=O(),{handlePlayList:l}=H(),x=(a,o,c)=>{const f=a.type==="ia"||a.identifier||a.url?.includes("archive.org");if(console.log("游꿧 Playing song:",{titulo:a.titulo,isIA:f,type:a.type,id:a.id,identifier:a.identifier,url:a.url?.substring(0,50)+"..."}),f)l(o===0?c:c.slice(o),0);else{const m=c.slice(o);t(m,0),h(a)}},h=async a=>{try{const c=(await B.post("/spectra/sync-local-song",{songId:a.id,title:a.titulo||a.title,artist:a.artista||a.artist||"Unknown",album:a.album||"Local Music",filepath:a.archivo||a.url,coverpath:a.portada||null,duration:a.duracion||a.duration||0,bitrate:a.bit_rate||0})).data;c.success&&!c.alreadyExists&&console.log("游늵 Canci칩n local sincronizada a Spectra para an치lisis:",a.titulo)}catch(o){console.warn("丘멆잺  No se pudo sincronizar a Spectra:",o.message)}};return e.jsxs("div",{className:"pb-24 md:pb-32",children:[e.jsx("div",{className:"pt-20 md:pt-24 px-4 md:px-8 mb-8",children:e.jsx("div",{className:"w-full max-w-[1600px] mx-auto",children:e.jsx(V,{selectedChip:i,onSelectChip:r})})}),e.jsx("div",{className:"flex flex-col gap-10 md:gap-14 px-0 md:px-8 max-w-[1600px] mx-auto",children:n?e.jsx("div",{className:"px-4 md:px-0",children:e.jsx(U,{count:8})}):e.jsx(G,{data:u,onPlay:x})})]})}export{X as default};
