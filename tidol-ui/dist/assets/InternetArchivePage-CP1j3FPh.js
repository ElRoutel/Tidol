import{n as Q,h as J,r as o,d as K,u as X,j as e,A as Y,z,B as Z,C as A,p as j,l as ee,D as te,a as M}from"./index-DEEaUcvV.js";import{u as se}from"./useLazyCaching--lO-_a-b.js";const w={FLAC:1,WAV:2,M4A:3,MP3:4,OGG:5,unknown:100};function ne(){const{identifier:c}=Q(),[_]=J(),v=_.get("autoplay")==="true",[l,I]=o.useState(null),[F,N]=o.useState(!0),[y,k]=o.useState(null),[f,L]=o.useState([]),[C,D]=o.useState([]),[g,P]=o.useState([]),[T,E]=o.useState([]),[m,R]=o.useState("best"),[u,B]=o.useState(!1),[G,S]=o.useState(new Set),{currentSong:O}=K(),{openContextMenu:b}=X(),{handlePlayList:h}=se(),U=(a,n)=>{const t=Object.values(a).filter(s=>s.name&&/\.(jpg|jpeg|png|gif)$/i.test(s.name)).map(s=>({name:s.name,size:s.size||0,url:`https://archive.org/download/${n}/${encodeURIComponent(s.name)}`}));if(t.length===0)return`https://archive.org/services/img/${n}`;const r=["cover","folder","album","front","artwork"];for(const s of r){const d=t.find(p=>p.name.toLowerCase().includes(s));if(d)return d.url}return t.sort((s,d)=>d.size-s.size),t[0].url};o.useEffect(()=>{(async()=>{try{N(!0);const t=(await M.get(`https://archive.org/metadata/${c}`)).data;try{const i=await M.get("/music/ia/likes");i.data&&S(new Set(i.data.map(x=>x.identifier)))}catch{console.log("Info: No logueado o sin likes")}if(!t||!t.metadata)throw new Error("No se encontraron metadatos.");const r=U(t.files||{},c),s={titulo:t.metadata?.title||c,autor:t.metadata?.creator||"Autor desconocido",portada:r,year:t.metadata?.year||t.metadata?.date||null,description:t.metadata?.description||null,totalDuration:0},d=Object.values(t.files||{}).filter(i=>i.name.match(/\.(mp3|flac|wav|m4a|ogg|MPEG-4)$/i)).map(i=>{const x=(i.format||"unknown").replace("Audio","").trim().toUpperCase(),$=parseFloat(i.length)||0;return s.totalDuration+=$,{titulo:i.name.split("/").pop().replace(/\.[^/.]+$/,"").replace(/^\d+\.\s*/,""),format:x,formatRank:w[x]||100,url:`https://archive.org/download/${c}/${encodeURIComponent(i.name)}`,artista:s.autor,album:s.titulo,id:`${c}_${i.name}`,identifier:`${c}_${i.name}`,parent_identifier:c,portada:r,duracion:$}});I(s),d.length===0&&k("No se encontraron archivos de audio."),L(d);const p=[...new Set(d.map(i=>i.format))];p.sort((i,x)=>(w[i]||100)-(w[x]||100)),E(p)}catch(n){k(n.message||"Error cargando álbum.")}finally{N(!1)}})()},[c]),o.useEffect(()=>{if(f.length===0)return;const a=f.reduce((r,s)=>(r[s.titulo]||(r[s.titulo]={title:s.titulo,artist:s.artista,formats:[]}),r[s.titulo].formats.push(s),r),{}),n=Object.values(a).map(r=>(r.formats.sort((s,d)=>s.formatRank-d.formatRank),{...r,best:r.formats[0]}));D(n);let t=m==="best"?n.map(r=>r.best):n.map(r=>r.formats.find(s=>s.format===m)).filter(Boolean);P(t),v&&t.length>0&&h(t,0)},[f,m,v,h]);const q=a=>{const n=g.findIndex(t=>t.id===a.id);n!==-1&&h(g,n)},V=(a,n)=>{S(t=>{const r=new Set(t);return n?r.add(a):r.delete(a),r})},W=(a,n)=>{a.stopPropagation();const t={...n,type:"ia-song"};b(a,"song",t)},H=a=>{if(!a)return"";const n=Math.floor(a/3600),t=Math.floor(a%3600/60);return n>0?`${n} h ${t} min`:`${t} min`};return F?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-white"})}):y?e.jsx("div",{className:"flex justify-center items-center h-screen text-red-400",children:e.jsx("h2",{className:"text-2xl font-bold",children:y})}):e.jsxs("div",{className:"relative min-h-screen pb-40 overflow-x-hidden font-sans text-white",children:[e.jsx("div",{className:"fixed inset-0 z-0",children:e.jsx(Y,{songId:c,colors:l?.extractedColors,intensity:.5})}),e.jsx("div",{className:"fixed inset-0 z-0 bg-gradient-to-b from-black/20 via-[#0a0a0a]/80 to-[#0a0a0a] pointer-events-none"}),e.jsxs("div",{className:"fixed top-0 left-0 w-full z-50 flex justify-between items-center px-4 py-4 md:hidden bg-transparent",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"w-10 h-10 rounded-full bg-black/20 backdrop-blur-md flex items-center justify-center text-white",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("button",{onClick:a=>b&&b(a,"album",l),className:"w-10 h-10 rounded-full bg-black/20 backdrop-blur-md flex items-center justify-center text-white",children:e.jsx(z,{size:24})})]}),e.jsx("div",{className:"relative z-10 px-6 pt-20 md:pt-32 pb-12 max-w-7xl mx-auto flex flex-col gap-8 md:gap-12",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-end gap-6 md:gap-12 text-center md:text-left",children:[e.jsx("div",{className:"w-[60vw] max-w-[250px] aspect-square md:w-72 md:h-72 shrink-0 shadow-2xl rounded-xl overflow-hidden glass-card flex items-center justify-center bg-white/5 mx-auto md:mx-0",children:e.jsx("img",{src:l?.portada,alt:l?.titulo,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex flex-col justify-end flex-grow gap-2 md:gap-4 w-full",children:[e.jsx("h1",{className:"text-2xl md:text-6xl font-black tracking-tight leading-tight shadow-md md:shadow-none line-clamp-3 px-2 md:px-0",children:l?.titulo}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-center gap-1 md:gap-2 justify-center md:justify-start",children:[e.jsx("span",{className:"text-xl md:text-xl font-bold text-[#1db954]",children:l?.autor}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400 font-medium mt-1 md:mt-0",children:[e.jsx("span",{className:"hidden md:inline",children:"•"}),e.jsx("span",{children:"Internet Archive"}),e.jsx("span",{className:"text-white/30",children:"•"}),e.jsx("span",{children:l?.year||"Año desc."})]})]}),e.jsxs("div",{className:"text-sm text-white/50 font-medium mt-1 hidden md:block",children:[C.length," canciones • ",H(l?.totalDuration)]}),l?.description&&e.jsxs("div",{className:"mt-2 max-w-2xl mx-auto md:mx-0 text-left",children:[e.jsx("div",{className:`text-sm text-white/70 leading-relaxed overflow-hidden transition-all duration-300 ${u?"max-h-[800px]":"max-h-[42px] line-clamp-2"}`,dangerouslySetInnerHTML:{__html:l.description}}),e.jsxs("button",{onClick:()=>B(!u),className:"mt-1 text-xs font-bold text-white/90 hover:text-white flex items-center gap-1",children:[u?"Menos":"Más",u?e.jsx(Z,{}):e.jsx(A,{})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full md:w-auto md:flex md:items-center md:gap-4 mt-6 md:mt-4",children:[e.jsxs("button",{onClick:()=>h(g,0),className:"h-[50px] md:h-12 md:px-8 md:py-3 rounded-full bg-[#1db954] md:bg-white text-black font-bold flex items-center justify-center gap-2 hover:scale-105 transition-transform shadow-lg md:shadow-xl group",children:[e.jsx(j,{size:22,className:"group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Reproducir"})]}),e.jsxs("select",{value:m,onChange:a=>R(a.target.value),className:"appearance-none bg-white/10 text-white/90 border border-white/10 px-4 py-2 pr-8 rounded-full text-sm font-medium hover:bg-white/20 focus:outline-none cursor-pointer transition-colors",children:[e.jsx("option",{value:"best",className:"bg-gray-900",children:"Calidad: Mejor"}),T.map(a=>e.jsx("option",{value:a,className:"bg-gray-900",children:a},a))]}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:e.jsx(A,{size:14})})]})]})]})}),e.jsxs("div",{className:"glass-card md:rounded-xl overflow-hidden animate-slide-up bg-transparent shadow-none border-none md:bg-white/5 md:shadow-xl md:border md:border-white/5",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-[50px_1fr_auto_60px_auto] gap-4 px-6 py-3 border-b border-white/5 text-sm text-gray-400 font-medium uppercase tracking-wider",children:[e.jsx("div",{className:"w-8 text-center",children:"#"}),e.jsx("div",{children:"Título"}),e.jsx("div",{className:"text-right",children:"Formato"}),e.jsx("div",{className:"text-right",children:e.jsx(ee,{size:18})}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"flex flex-col pb-4 md:pb-0",children:C.map((a,n)=>{const t=m==="best"?a.best:a.formats.find(s=>s.format===m);if(!t)return null;const r=O?.id===t.id;return e.jsxs("div",{className:`group relative grid grid-cols-[32px_1fr_40px] md:grid-cols-[50px_1fr_auto_60px_auto] gap-3 md:gap-4 px-0 md:px-6 py-2 md:py-3 items-center hover:bg-white/5 transition-colors cursor-pointer min-h-[64px] border-b border-white/5 md:border-b-0 ${r?"bg-white/10 rounded-lg md:rounded-none":""}`,onClick:()=>q(t),children:[e.jsxs("div",{className:"text-left md:text-center text-gray-500 font-medium text-sm md:w-8 pl-1 md:pl-0 flex items-center justify-start md:justify-center",children:[r?e.jsx(j,{className:"text-[#1db954]"}):e.jsx("span",{className:"block group-hover:hidden",children:n+1}),e.jsx(j,{className:`hidden group-hover:block text-white ${r?"hidden":""}`})]}),e.jsxs("div",{className:"min-w-0 flex flex-col justify-center",children:[e.jsx("div",{className:`text-[16px] font-medium leading-tight truncate mb-0.5 ${r?"text-[#1db954]":"text-white"}`,children:t.titulo}),e.jsx("div",{className:"hidden md:block text-[14px] text-gray-400 truncate font-normal",children:t.artista})]}),e.jsx("div",{className:"hidden md:block text-right",children:e.jsx("span",{className:"bg-white/10 text-gray-300 text-[10px] px-2 py-0.5 rounded font-bold uppercase tracking-wider",children:t.format})}),e.jsxs("div",{className:"text-sm text-gray-400 font-variant-numeric tabular-nums text-right hidden md:block",children:[Math.floor(t.duracion/60),":",Math.floor(t.duracion%60).toString().padStart(2,"0")]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",onClick:s=>s.stopPropagation(),children:[e.jsx(te,{song:t,isLiked:G.has(t.identifier),onLikeToggle:V}),e.jsx("button",{className:"p-3 md:p-2 text-gray-400 hover:text-white transition-colors",onClick:s=>W(s,t),children:e.jsx(z,{size:20})})]})]},t.id)})})]})]})}export{ne as default};
