import{r as y,a as f,u as k,j as t,d as x,H as v}from"./index-DEEaUcvV.js";import{F as j}from"./index-C5l2ZN2-.js";import{S as L}from"./SkeletonSongList-DCf44Kff.js";const m=()=>{const[e,r]=y.useState("favorites"),[l,g]=y.useState("grid"),[n,a]=y.useState({favorites:[],iaLikes:[],playlists:[]}),[o,d]=y.useState(!1),c=y.useCallback(async u=>{d(!0);try{let s="",i="";switch(u){case"favorites":s="/music/songs/likes",i="favorites";break;case"ia-likes":s="/music/ia/likes",i="iaLikes";break;case"playlists":s="/playlists",i="playlists";break;default:return}const h=await f.get(s);a(b=>({...b,[i]:h.data||[]}))}catch(s){console.error(`Error fetching library data for ${u}:`,s)}finally{d(!1)}},[]);return y.useEffect(()=>{c(e)},[e,c]),{currentView:e,setCurrentView:r,layout:l,setLayout:g,data:n[e==="favorites"?"favorites":e==="ia-likes"?"iaLikes":"playlists"],isLoading:o,refresh:()=>c(e)}};function N({title:e,subtitle:r,image:l,onClick:g,viewMode:n="list",item:a=null,type:o="song"}){const{openContextMenu:d}=k(),c=s=>{if(a&&o==="song"){s.preventDefault(),s.stopPropagation();const i={id:a.id||a.identifier,titulo:a.titulo||a.title||e,artista:a.artista||a.artist||r,album:a.album||a.album_name,portada:a.portada||a.cover_url||l,url:a.url,duracion:a.duracion||a.duration,artistId:a.artistId||a.artista_id,albumId:a.albumId||a.album_id,format:a.format,quality:a.quality};d(s,o,i)}},u=s=>{c(s)};return t.jsxs("div",{className:`lib-item ${n} ${o==="song"?"song-item":""}`,onClick:g,onContextMenu:c,"data-id":a?.id||a?.identifier,children:[t.jsx("img",{src:l,className:"lib-item-img",alt:e,decoding:"async",loading:"lazy"}),t.jsxs("div",{className:"lib-item-info",children:[t.jsx("h4",{children:e}),t.jsx("p",{children:r})]}),o==="song"&&t.jsx("button",{className:"lib-item-menu-btn",onClick:u,children:t.jsx(j,{})})]})}const p="/assets/favImage-Dtu7Vtas.jpg";function I(){const{currentView:e,setCurrentView:r,layout:l,setLayout:g,data:n,isLoading:a}=m(),{playSongList:o}=x();console.log("LibraryPage Render:",{currentView:e,layout:l,dataLength:n?.length,isLoading:a});const d=v({onSwipedLeft:()=>{e==="favorites"?r("ia-likes"):e==="ia-likes"&&r("playlists")},onSwipedRight:()=>{e==="playlists"?r("ia-likes"):e==="ia-likes"&&r("favorites")},delta:50,trackMouse:!0}),c=async s=>{try{const i=await f.get(`/playlists/${s}/songs`);i.data&&i.data.length>0?o(i.data,0):alert("Esta playlist estÃ¡ vacÃ­a")}catch(i){console.error(i)}},u=s=>e==="playlists"?`${s.canciones?s.canciones.length:0} canciones`:s.artista||s.artist||s.subtitle||"Desconocido";return t.jsxs("div",{className:"lib-container",...d,children:[t.jsxs("div",{className:"lib-chips-row",children:[[{key:"favorites",label:"Favoritos"},{key:"ia-likes",label:"IA Likes"},{key:"playlists",label:"Playlists"}].map(s=>t.jsx("button",{className:`lib-chip ${e===s.key?"active":""}`,onClick:()=>r(s.key),children:s.label},s.key)),t.jsx("button",{className:"lib-chip layout-chip",onClick:()=>g(l==="grid"?"list":"grid"),children:l==="grid"?"ğŸ“„ Lista":"ğŸ”³ Grid"})]}),t.jsxs("div",{className:"lib-header glass-card",children:[t.jsx("div",{className:"lib-header-img-wrapper",children:t.jsx("img",{src:p,alt:"Header",className:"lib-header-img"})}),t.jsxs("div",{className:"lib-header-text",children:[t.jsx("h5",{className:"lib-subtitle",children:"ColecciÃ³n"}),t.jsxs("h1",{className:"lib-title",children:[e==="favorites"&&"Tus Favoritos",e==="ia-likes"&&"Internet Archive",e==="playlists"&&"Tus Playlists"]}),t.jsxs("p",{className:"lib-count",children:[n.length," elementos"]})]})]}),t.jsxs("div",{className:`lib-grid ${l}`,style:{height:"calc(100vh - 220px)"},children:[a&&t.jsx(L,{count:12}),!a&&n.length>0&&(l==="list_DISABLED_DEBUG"?t.jsx(VirtualSongList,{songs:n,currentView:e,layout:l,onPlay:(s,i)=>{e==="playlists"?c(s[i].id):o(s,i)}}):n.map((s,i)=>{const h=s.id||s.identifier||`idx-${i}`;return t.jsx(N,{title:s.titulo||s.title||s.nombre||"Sin tÃ­tulo",subtitle:u(s),image:s.portada||s.cover_url||p,viewMode:l,item:s,type:e==="playlists"?"playlist":"song",onClick:()=>{e==="playlists"?c(s.id):o(n,i)}},h)}))]})]})}export{I as default};
