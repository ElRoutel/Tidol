import{h as b,r as x,a as y,j as e,i as N,k as S,f as w,d as k,l as P,m as H}from"./index-DEEaUcvV.js";import{U as f}from"./UniversalCard-BGUcIsBF.js";import"./index-C5l2ZN2-.js";const I=()=>{const[i,o]=b(),t=i.get("q")||"",[d,u]=x.useState(!1),[n,m]=x.useState({canciones:[],albums:[],artists:[],archive:[]}),[h,c]=x.useState([]);x.useEffect(()=>{const r=localStorage.getItem("tidol_search_history");r&&c(JSON.parse(r))},[]);const v=r=>!r||r.length===0?[]:r.map(s=>{const l=s.identifier||(s.id&&s.id.startsWith("ia_")?s.id.replace("ia_",""):s.id);return{id:s.id||`ia_${l}`,identifier:l,titulo:s.titulo||s.title||"Sin tÃ­tulo",artista:s.artista||s.artist||s.creator||"Autor desconocido",url:s.url||`https://archive.org/details/${l}`,portada:`https://archive.org/services/img/${l}`,duracion:s.duracion||s.duration||null,album:s.album||null,year:s.year||null}}),p=x.useCallback(async r=>{u(!0);try{const l=(await y.get(`/music/searchAll?q=${encodeURIComponent(r)}`)).data||{};m({canciones:l.canciones||[],albums:l.albums||[],artists:l.artists||[],archive:v(l.archive||[])})}catch(s){console.error("Error buscando:",s)}finally{u(!1)}},[]);x.useEffect(()=>{t.trim()!==""?p(t):m({canciones:[],albums:[],artists:[],archive:[]})},[t,p]);const a=r=>{let s=[r,...h.filter(l=>l!==r)];s=s.slice(0,10),c(s),localStorage.setItem("tidol_search_history",JSON.stringify(s))};return{query:t,loading:d,results:n,searchHistory:h,handleSearch:r=>{if(!r||r.trim()===""){o({});return}o({q:r}),a(r)},removeFromHistory:r=>{const s=h.filter(l=>l!==r);c(s),localStorage.setItem("tidol_search_history",JSON.stringify(s))},hasResults:n.canciones.length>0||n.albums.length>0||n.artists.length>0||n.archive.length>0}};function _({onSearch:i,loading:o,initialValue:t=""}){const[d,u]=x.useState(t),[n,m]=x.useState(!1);x.useEffect(()=>{u(t)},[t]);const h=c=>{c.key==="Enter"&&(d.trim()&&i(d),c.target.blur())};return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:`
            relative flex items-center
            bg-gradient-to-br from-[#1a1a1a] to-black /* Ajustado a tu paleta dark */
            border border-white/10
            rounded-full
            shadow-lg hover:shadow-xl
            transition-all duration-300 ease-out
            ${n?"ring-1 ring-green-500 scale-[1.01] border-green-500/50":""}
            ${o?"opacity-80":""}
          `,children:[e.jsx("div",{className:"absolute left-4 flex items-center pointer-events-none",children:e.jsx(N,{className:`
                transition-all duration-300
                ${n?"text-green-500":"text-gray-400"}
              `,size:20})}),e.jsx("input",{type:"text",placeholder:"Â¿QuÃ© quieres escuchar?",value:d,onChange:c=>u(c.target.value),onKeyDown:h,onFocus:()=>m(!0),onBlur:()=>m(!1),disabled:o,className:`
              w-full
              bg-transparent
              text-white
              placeholder-gray-500
              text-base
              font-medium
              py-3 pl-12 pr-12 /* Ajustado padding para iconos */
              outline-none
              transition-all duration-300
              disabled:cursor-not-allowed
            `}),o&&e.jsx("div",{className:"absolute right-4 flex items-center",children:e.jsx(S,{className:"text-green-500 animate-spin",size:20})})]})})})}function E(){const{query:i,loading:o,results:t,searchHistory:d,handleSearch:u,removeFromHistory:n,hasResults:m}=I(),h=w(),{playSongList:c}=k(),v=async a=>{try{await y.post("/music/ia/click",{query:i,identifier:a.identifier,title:a.titulo})}catch{}h(`/ia-album/${a.identifier}`)},p=!i&&d.length>0;return e.jsxs("div",{className:"search-page",children:[e.jsx("div",{className:"search-header glass-card",children:e.jsx(_,{onSearch:u,loading:o,initialValue:i})}),p&&e.jsxs("div",{className:"mt-5 px-2",children:[e.jsx("h3",{className:"text-sm text-gray-400 mb-3 font-semibold pl-1",children:"BÃºsquedas recientes"}),e.jsx("div",{className:"flex flex-col gap-2",children:d.map((a,g)=>e.jsxs("div",{className:"flex justify-between items-center p-3 cursor-pointer rounded-lg hover:bg-white/10 transition-colors glass-card",onClick:()=>u(a),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"text-lg text-gray-400"}),e.jsx("span",{className:"text-white text-sm",children:a})]}),e.jsx("button",{className:"text-gray-400 hover:text-red-400 p-1 rounded-full hover:bg-white/5 transition-colors",onClick:j=>{j.stopPropagation(),n(a)},children:e.jsx(H,{size:20})})]},g))})]}),!i&&d.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center p-8 glass-card rounded-2xl mt-10",children:[e.jsx("div",{className:"text-6xl mb-6 animate-bounce",children:"ðŸ”"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Descubre tu mÃºsica"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"Busca canciones, Ã¡lbumes y artistas."})]}),!o&&i&&!m&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center p-8 glass-card rounded-2xl mt-10",children:[e.jsx("div",{className:"text-6xl mb-6",children:"ðŸ˜•"}),e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:['No encontramos "',i,'"']}),e.jsx("p",{className:"text-gray-400 text-lg",children:"Intenta con otros tÃ©rminos."})]}),e.jsxs("div",{className:"flex flex-col gap-10 mt-8 pb-20",children:[t.artists.length>0&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("div",{className:"mb-5 px-4 py-3 glass-card rounded-xl inline-block",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Artistas"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:t.artists.map(a=>e.jsx(f,{data:a,type:"artist",variant:"shelf",onPlay:()=>h(`/artist/${a.id}`)},a.id))})]}),t.albums.length>0&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("div",{className:"mb-5 px-4 py-3 glass-card rounded-xl inline-block",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Ãlbumes"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:t.albums.map(a=>e.jsx(f,{data:a,type:"album",variant:"shelf",onPlay:()=>h(`/album/${a.id}`)},a.id))})]}),t.canciones.length>0&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("div",{className:"mb-5 px-4 py-3 glass-card rounded-xl inline-block",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Canciones"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:t.canciones.map((a,g)=>e.jsx(f,{data:a,type:"song",variant:"shelf",onPlay:()=>c(t.canciones,g)},a.id))})]}),t.archive.length>0&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("div",{className:"mb-5 px-4 py-3 glass-card rounded-xl inline-block",children:e.jsx("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:"Internet Archive ðŸŒ"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:t.archive.map((a,g)=>e.jsx(f,{data:a,type:"song",variant:"shelf",onPlay:()=>v(a)},a.id||g))})]})]})]})}export{E as SearchPage};
